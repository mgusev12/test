{
	"id": "623b103e6c5347019d000014",
	"title": "Polus_Issue_ onSave",
	"hookType": "onSave",
	"function": "function onSave(props) {\n  const { item, user } = props;\n  //formInstance = Object.assign(Object.create(Object.getPrototypeOf(item)), item);\n  const formInstance = { ...item };\n  const { data } = formInstance;\n  const fields = [\"members.responsible\", \"members.executor\", \"members.eliminationResponsible\"];\n  const issueStatus_opened = \"opened\";\n  const issueStatus_draft = \"draft\";\n  const issueStatus_eliminated = \"eliminated\";\n  const issueStatus_closed = \"closed\";\n  const memberStatus = [];\n  let nowdate = new Date();\n  let reviewers = new Set();\n\n  delete formInstance.data.selectTab;\n\n  formInstance.data.responsibleCheck = \"responsible\";\n  formInstance.data.executorChek = \"executor\"\n  \n  if ((formInstance.data.members) && (formInstance.data.members.responsible) && formInstance.data.members.responsible.length != 0){\n    formInstance.data.responsibleCheck = formInstance.data.members.responsible[0]\n  }\n  if ((formInstance.data.members) && (formInstance.data.members.executor) && formInstance.data.members.executor.length != 0){\n    formInstance.data.executorCheck = formInstance.data.members.executor[0]\n  }\n  \n  if (formInstance.data.dateCheck.oldDate != 0){\n    if (formInstance.data.dateCheck.oldDate != formInstance.data.info.dateTime){\n      formInstance.data.dateCheck.dateCount++\n    }\n  }\n  \n  formInstance.data.dateCheck.oldDate = formInstance.data.info.dateTime\n  \n  fields.forEach((field) => {\n    const val = field.split(\".\").reduce((p, c) => p && p[c], data);\n    if (val) {\n      val.forEach((userId) => reviewers.add(userId));\n    }\n  });\n  formInstance.reviewers = Array.from(reviewers);\n\n  if (formInstance.data.memberStatus.responsibleStatus === \"notIssued\") {\n    formInstance.data.issueStatus = [\"draft\"];\n    if (formInstance.data.memberStatus.executorStatus && (formInstance.data.issueStatus[0] != issueStatus_draft)){\n      delete formInstance.data.memberStatus.executorStatus\n    }\n    if (formInstance.data.memberStatus.eliminationConfirmation && (formInstance.data.issueStatus[0] != issueStatus_draft)){  \n      delete formInstance.data.memberStatus.eliminationConfirmation\n    }\n  } \n  if (((formInstance.data.issueStatus && ((formInstance.data.issueStatus[0] === issueStatus_draft)) || !(formInstance.data.issueStatus )) && formInstance.data.memberStatus.responsibleStatus === \"issued\") || (formInstance.data.issueStatus &&  formInstance.data.issueStatus[0] === issueStatus_eliminated && formInstance.data.memberStatus.responsibleStatus === \"issued\" && formInstance.data.memberStatus.executorStatus === \"issued\" && formInstance.data.memberStatus.eliminationConfirmation === \"notIssued\") || (formInstance.data.issueStatus && formInstance.data.issueStatus[0] === issueStatus_eliminated) && formInstance.data.memberStatus.executorStatus === \"notIssued\") {\n    formInstance.data.issueStatus = [\"opened\"];\n    if (formInstance.data.memberStatus.executorStatus === \"issued\"){\n      delete formInstance.data.memberStatus.executorStatus\n    }\n    formInstance.data.memberStatus.executorStatus = \"notIssued\"\n  } \n  if (formInstance.data.issueStatus && formInstance.data.issueStatus[0] === issueStatus_opened && formInstance.data.memberStatus.responsibleStatus === \"issued\" && formInstance.data.memberStatus.executorStatus === \"issued\") {\n    formInstance.data.issueStatus = [\"eliminated\"];\n    if (formInstance.data.memberStatus.eliminationConfirmation){\n      delete formInstance.data.memberStatus.eliminationConfirmation\n    }\n  } \n  if (formInstance.data.memberStatus.responsibleStatus === \"issued\" && formInstance.data.memberStatus.executorStatus === \"issued\" && formInstance.data.memberStatus.eliminationConfirmation === \"issued\" && formInstance.data.memberStatus.close == 1) {\n    formInstance.data.issueStatus = [\"closed\"];\n    if (!(formInstance.data.exitTime)){  \n      formInstance.data.exitTime = new Date().setMonth(nowdate.getMonth());\n    }\n  }\n\n  console.log(formInstance);\n  return formInstance;\n}\n\n\n  \n",
	"form": "623b0f296c5347019d00000c",
	"relationsData": [],
	"createdDate": 1648037950968,
	"updatedDate": 1659595445587,
	"owner": null,
	"assignedTo": null,
	"parent": null
}