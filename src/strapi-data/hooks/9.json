{
	"id": "62837e0b98497201a50004ce",
	"title": "Polus_Trial_onSave",
	"hookType": "onSave",
	"function": "function onSave(props) {\n    const { item, user } = props;\n    //formInstance = Object.assign(Object.create(Object.getPrototypeOf(item)), item);\n    const formInstance = { ...item };\n    const { data } = formInstance;\n    const fields = [\"members.applicant\", \"members.executor\"];\n    const trialStatus_draft = \"draft\";\n    const trialStatus_review = \"review\";\n    const trialStatus_confirmed = \"confirmed\";\n    const trialStatus_rejected = \"rejected\";\n    const trialStatus_closed = \"closed\";\n    const memberStatus = [];\n    let reviewers = new Set();\n\n\n    delete formInstance.data.selectTab;\n  \n    formInstance.data.applicantCheck = \"\"\n    formInstance.data.executorCheck = \"\"\n  \n    if (formInstance.data.members && formInstance.data.members.applicant && formInstance.data.members.applicant.length != 0){\n      formInstance.data.applicantCheck = formInstance.data.members.applicant[0]\n    }\n  \n    if (formInstance.data.members && formInstance.data.members.executor && formInstance.data.members.executor.length != 0){\n      formInstance.data.executorCheck = formInstance.data.members.executor[0]\n    }\n  \n\n    fields.forEach((field) => {\n        const val = field.split(\".\").reduce((p, c) => p && p[c], data);\n        if (val) {\n            val.forEach((userId) => reviewers.add(userId));\n        }\n    });\n    formInstance.reviewers = Array.from(reviewers);\n\n    if (formInstance.data.checkStatus && formInstance.data.checkStatus.applicantStatus === \"notReady\") {\n        formInstance.data.issueStatus = [\"draft\"];\n    }\n\n    if (formInstance.data.checkStatus && formInstance.data.checkStatus.applicantStatus === \"ready\") {\n        if (! (formInstance.data.issueStatus) || formInstance.data.issueStatus[0] === \"rejected\" || formInstance.data.issueStatus[0] === \"draft\") {\n            delete formInstance.data.checkStatus.executorStatus;\n            delete formInstance.data.checkStatus.trialReason;\n        }\n        formInstance.data.issueStatus = [\"review\"];\n    }\n\n    if (formInstance.data.checkStatus.applicantStatus === \"ready\" && formInstance.data.checkStatus && formInstance.data.checkStatus.executorStatus && formInstance.data.checkStatus.executorStatus === \"accept\" || formInstance.data.checkStatus.trialReason && formInstance.data.checkStatus.executorStatus === \"accept\") {\n        formInstance.data.issueStatus = [\"confirmed\"];\n        formInstance.data.checkStatus.applicantStatus = \"ready\";\n        delete formInstance.data.checkStatus.trialReason;\n    }\n  \n    if (formInstance.data.checkStatus.applicantStatus === \"ready\" && formInstance.data.checkStatus && formInstance.data.checkStatus.executorStatus && formInstance.data.checkStatus.executorStatus === \"notAccept\") {\n        formInstance.data.issueStatus = [\"rejected\"];\n        formInstance.data.checkStatus.applicantStatus = \"notReady\"\n    }\n\n    if (formInstance.data.checkStatus.applicantStatus === \"ready\" && formInstance.data.checkStatus && formInstance.data.checkStatus.executorStatus && formInstance.data.checkStatus.executorStatus === \"accept\" && formInstance.data.checkStatus.exitCheck && formInstance.data.checkStatus.exitCheck == 1) {\n        formInstance.data.issueStatus = [\"closed\"];\n    }\n\n    console.log(formInstance);\n    return formInstance;\n}\n\n",
	"form": "6260fd3f98497201a500000f",
	"relationsData": [],
	"createdDate": 1652784651937,
	"updatedDate": 1661242458373,
	"owner": null,
	"assignedTo": null,
	"parent": null
}