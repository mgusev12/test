{
	"id": "628f3a4d98497201a500086e",
	"title": "Polus_Request_onSave",
	"hookType": "onSave",
	"function": "function onSave(props) {\n    const { item, user } = props;\n    //formInstance = Object.assign(Object.create(Object.getPrototypeOf(item)), item);\n    const formInstance = { ...item };\n    const { data } = formInstance;\n    const fields = [\"subcontractor.user\", \"customerRepresentative.user\", \"representativeDesignerSupervisor.user\"];\n    const requestStatus_draft = \"draft\";\n    const requestStatus_review = \"review\";\n    const requestStatus_confirmed = \"confirmed\";\n    const requestStatus_rejected = \"rejected\";\n    const requestStatus_accepted = \"accepted\";\n   const requestStatus_notAccepted = \"notAccepted\";\n    const memberStatus = [];\n    let reviewers = new Set();\n  \n    delete formInstance.data.selectTab;\n  \n  formInstance.data.subcontractor.check = \"subcontractor\"\n  formInstance.data.customerRepresentative.check = \"customerRepresentative\"\n  formInstance.data.representativeDesignerSupervisor.check  = \"representativeDesignerSupervisor\"\n  \n  if ((formInstance.data.subcontractor) && (formInstance.data.subcontractor.user) && formInstance.data.subcontractor.user != 0) {\n    formInstance.data.subcontractor.check  = formInstance.data.subcontractor.user[0]\n  }\n  if ((formInstance.data.customerRepresentative) && (formInstance.data.customerRepresentative.user) && formInstance.data.customerRepresentative.user != 0){\n    formInstance.data.customerRepresentative.check  = formInstance.data.customerRepresentative.user[0]\n  }\n  if ((formInstance.data.representativeDesignerSupervisor) && (formInstance.data.representativeDesignerSupervisor.user) && formInstance.data.representativeDesignerSupervisor.user != 0){\n    formInstance.data.representativeDesignerSupervisor.check  = formInstance.data.representativeDesignerSupervisor.user[0]\n  }\n  \n  \n    fields.forEach((field) => {\n      const val = field.split(\".\").reduce((p, c) => p && p[c], data);\n      if (val) {\n        val.forEach((userId) => reviewers.add(userId));\n      }\n    });\n    formInstance.reviewers = Array.from(reviewers);\n  \n    if (formInstance.data.subcontractor.selectOne === \"notReady\") {\n      formInstance.data.requestStatus = [\"draft\"];\n    } \n  \n    if ((!(formInstance.data.requestStatus) || formInstance.data.requestStatus && formInstance.data.requestStatus[0] != \"review\") && formInstance.data.subcontractor.selectOne === \"ready\") {\n      formInstance.data.requestStatus = [\"review\"];\n    } \n  \n    if (formInstance.data.requestStatus && formInstance.data.requestStatus.length != 0 && formInstance.data.requestStatus[0] === \"review\" && formInstance.data.customerRepresentative.selectOne === \"accept\") {\n      formInstance.data.requestStatus = [\"confirmed\"];\n    } \n  \n    if (formInstance.data.requestStatus && formInstance.data.requestStatus.length != 0 && formInstance.data.requestStatus[0] === \"review\" && formInstance.data.customerRepresentative.selectOne === \"rejected\") {\n      formInstance.data.requestStatus = [\"rejected\"];\n    }\n  \n    if (typeof(formInstance.data.result) != \"undefined\" && formInstance.data.requestStatus && formInstance.data.requestStatus.length != 0 &&  formInstance.data.requestStatus[0] === \"confirmed\"){\n      if (typeof(formInstance.data.result.selectOne) != \"undefined\" && typeof(formInstance.data.result.close) != \"undefined\" && formInstance.data.result.selectOne === \"accept\" && formInstance.data.result.close == 1) {\n      formInstance.data.requestStatus = [\"accepted\"];\n    }\n    else if (typeof(formInstance.data.result.selectOne) != \"undefined\" && typeof(formInstance.data.result.close) != \"undefined\" && formInstance.data.result.selectOne === \"rejected\" && formInstance.data.result.close == 1){ \n        formInstance.data.requestStatus = [\"notAccepted\"];\n    }\n    }\n    console.log(formInstance.data)\n    return formInstance;\n  }\n  ",
	"form": "6260fd7098497201a5000013",
	"relationsData": [],
	"createdDate": 1653553741571,
	"updatedDate": 1659442692817,
	"owner": null,
	"assignedTo": null,
	"parent": null
}