{
	"id": "62a3360998497201a5000f7c",
	"title": "Polus_InControl_onSave",
	"hookType": "onSave",
	"function": "function onSave(props) {\n    const { item, user } = props;\n    console.log(\"onSave\", props);\n    //const formInstance = Object.assign(Object.create(Object.getPrototypeOf(item)), item);\n    const formInstance = {...item};\n    const { data } = formInstance;\n    const fields = [ \"responsible.user\", \"supervision.user\", \"engineer.user\", \"subcontractor.user\"];\n\tlet reviewers = new Set();\n\n  fields.forEach((field) => {\n      const val = field.split(\".\").reduce((p, c) => p && p[c], data);\n      if (val) {\n        val.forEach((userId) => reviewers.add(userId));\n      }\n    });\n    formInstance.reviewers = Array.from(reviewers);\n\n  delete formInstance.data.selectTab;\n  \n  if (formInstance.data.subcontractor){\n  formInstance.data.subcontractor.check = \"subcontractor\"\n  }\n  \n  if (formInstance.data.supervision){\n  formInstance.data.supervision.check = \"supervision\"\n  }\n  \n  if (formInstance.data.engineer){\n  formInstance.data.engineer.check  = \"engineer\"\n  }\n  \n  if (formInstance.data.responsible){\n  formInstance.data.responsible.check  = \"responsible\"\n  }\n  \n  if ((formInstance.data.subcontractor) && (formInstance.data.subcontractor.user) && formInstance.data.subcontractor.user != 0) {\n    formInstance.data.subcontractor.check  = formInstance.data.subcontractor.user[0]\n  }\n  \n  if ((formInstance.data.supervision) && (formInstance.data.supervision.user) && formInstance.data.supervision.user != 0) {\n    formInstance.data.supervision.check  = formInstance.data.supervision.user[0]\n  }\n  \n  if ((formInstance.data.engineer) && (formInstance.data.engineer.user) && formInstance.data.engineer.user != 0) {\n    formInstance.data.engineer.check  = formInstance.data.engineer.user[0]\n  }\n  \n  if ((formInstance.data.responsible) && (formInstance.data.responsible.user) && formInstance.data.responsible.user != 0) {\n    formInstance.data.responsible.check  = formInstance.data.responsible.user[0]\n  }\n  \n  if (formInstance.data.responsible && formInstance.data.responsible.selectOne && formInstance.data.responsible.selectOne === \"notReady\") {\n      formInstance.data.inControlStatus = [\"draft\"]\n  }\n  \n  if (formInstance.data.responsible && formInstance.data.responsible.selectOne && formInstance.data.responsible.selectOne === \"ready\") {\n      formInstance.data.inControlStatus = [\"review\"]\n  }\n  \n  if (formInstance.data.responsible && formInstance.data.responsible.selectOne && formInstance.data.responsible.selectOne === \"ready\" && formInstance.data.engineer && formInstance.data.engineer.selectOne === \"accept\" && (!(formInstance.data.supervision) || (formInstance.data.supervision) && (formInstance.data.supervision.user) && formInstance.data.supervision.selectOne === \"accept\") && (!(formInstance.data.subcontractor) || (formInstance.data.subcontractor) && (formInstance.data.subcontractor.user) && formInstance.data.subcontractor.selectOne === \"accept\")){\n      formInstance.data.inControlStatus = [\"confirmed\"]\n  }\n  \n  if (formInstance.data.responsible.selectOne === \"ready\" && (formInstance.data.engineer.selectOne === \"notAccept\" || (formInstance.data.supervision) && (formInstance.data.supervision.user) && formInstance.data.supervision.selectOne === \"notAccept\" || (formInstance.data.subcontractor) && (formInstance.data.subcontractor.user) && formInstance.data.subcontractor.selectOne === \"notAccept\")){\n      formInstance.data.inControlStatus = [\"rejected\"]\n  }\n\n  if (formInstance.data.inControlStatus && formInstance.data.inControlStatus[0] === \"confirmed\" && (formInstance.data.result) && formInstance.data.result.selectOne && formInstance.data.result.selectOne === \"accept\" && (formInstance.data.result.close) && formInstance.data.result.close[0] === 1){\n      formInstance.data.inControlStatus = [\"accepted\"]\n  }\n  \n  if (formInstance.data.inControlStatus && formInstance.data.inControlStatus[0] === \"confirmed\" && (formInstance.data.result) && formInstance.data.result.selectOne && formInstance.data.result.selectOne === \"rejected\" && (formInstance.data.result.close) && formInstance.data.result.close[0] === 1){\n      formInstance.data.inControlStatus = [\"notAccepted\"]\n  }\n  \n  if (formInstance.data.inControlStatus && formInstance.data.inControlStatus[0] === \"confirmed\" && (formInstance.data.result) && formInstance.data.result.selectOne && formInstance.data.result.selectOne === \"accept\"){\n      formInstance.data.crCheck = \"2\"\n  }\n  \n  if (formInstance.data.inControlStatus && formInstance.data.inControlStatus[0] === \"confirmed\" && (formInstance.data.result) && formInstance.data.result.selectOne && formInstance.data.result.selectOne === \"rejected\"){\n      formInstance.data.crCheck = \"3\"\n  }\n    \n    return formInstance;\n}",
	"form": "62a1f67e98497201a5000f1c",
	"relationsData": [],
	"createdDate": 1654863369443,
	"updatedDate": 1660042588522,
	"owner": null,
	"assignedTo": null,
	"parent": null
}